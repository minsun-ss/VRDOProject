from selenium import webdriver

browser = webdriver.Firefox()
browser.get("https://emma.msrb.org/Security/Details/A9963E0ACA98CBCC0DD0E9EE46D0B7114")
getin = browser.find_elements_by_class_name("yesButton")
getin[0].click()

#initialize variables
EMMAIssue1 = ""
InterestRate = 0
MaturityDate = ""
DatedDate = ""
PrincipalAmount = 0
ResetPeriod = ""
MaximumRate = ""
MinimumRate = ""
ClosingDate = ""
MinimumDenomination = ""
NotificationPeriod = ""
InitialOffering = ""
RemarketingAgent = ""

showMore = browser.find_element_by_id("lnkMoreInfo")
showMore.click()
results = browser.page_source
#print(results)

innerHTML = browser.execute_script("return document.body.innerHTML")
#print(innerHTML)
getTitle = browser.find_elements_by_xpath("//span[@help='Click to view issue details']")
EMMAIssue1 = str(getTitle[0].text)

getValues = browser.find_elements_by_xpath("//div[@class='card-body']/ul/li/span")
for i in range(len(getValues)):
    if getValues[i].text == "Interest Rate:":
        InterestRate = getValues[i+1].text
    elif getValues[i].text == "Maturity Date:":
        MaturityDate = getValues[i+1].text
    elif getValues[i].text == "Dated Date:":
        DatedDate = getValues[i+1].text
    elif getValues[i].text == "Principal Amount at Issuance:":
        PrincipalAmount = getValues[i+1].text
        ResetPeriod = getValues[i+2].text
        MaximumRate = getValues[i+3].text
        MinimumRate = getValues[i+4].text
    elif getValues[i].text =="Closing Date:":
        ClosingDate = getValues[i+1].text

# not sure if I need these if I'm just stripping out the main parts of a deal - this might be better used when
# stripping data for liquidity facilities
#getValues2 = browser.find_elements_by_xpath("//div[@id='divCollapsible']/ul/li/span")
#print(len(getValues2))
#for j in range(len(getValues2)):
#    print(getValues2[j].text)


print(EMMAIssue1+","+InterestRate+","+MaturityDate+","+DatedDate+","+PrincipalAmount+","+ResetPeriod+","+MaximumRate+","+MinimumRate+","+ClosingDate)
browser.close()